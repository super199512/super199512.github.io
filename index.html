
<!DOCTYPE html>
{% load static %}
<html lang="en" dir="ltr">

<style>
        .xyz{
          margin-bottom: 0px;
          background-image: url('{% static "image/homepage.jpg" %}');
          background-size: cover;
          background-repeat: no-repeat;
        }
</style>
<body>
  {% include "insurance/navbar.html" %}
<br>
<section id="section-jumbotron" style="margin-bottom: 0px;" class="jumbotron jumbotron-fluid d-flex justify-content-center align-items-center xyz">
  <div class="container text-center">
      <br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
    
  </div>  
</section>


<div class="jumbotron" style="margin-top: 0px;margin-bottom: 0px;">

  <p class="lead text-center"> “Leave Sooner Drive Slower Live Longer.”
    </p>
  
  <p class="text-center">- MVD</p>
  
</div>
  {% include "insurance/footer.html" %}


</body>

</html>


<!DOCTYPE html>
{% load static %}
<html lang="en" dir="ltr">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">




</head>

<body>

  {% include "insurance/navbar.html" %}
  <br><br>

  <center>
    <h3 class='alert alert-success'>Send Us Your Valuable Feedback !</h3>

    <form method="POST" autocomplete="off">
      <!-- Very Important csrf Token -->
      {% csrf_token %}
      <div class="form-group">
        <p>
        <h3>{{ form.as_p }}</h3>
        </p>
        <br>
        <input type="submit" value="Send Message" class='btn btn-primary btn-lg'>
      </div>
    </form>
  </center>

  {% include "insurance/footer.html" %}
</body>

</html>

<!DOCTYPE html>
{% load static %}
<html lang="en">

<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

  <style type="text/css">
    .bs-example {
      margin: 0px;

    }
    .bg-dark {
    background-color: #212529!important;
}
    .navbar-brand {
      font-size: 20px;
      font-family: monospace;
      
    }
  </style>
</head>

<body>



  <div class="bs-example">
    <nav class="navbar navbar-expand-md  navbar-dark fixed-top" style="background-color: #000000;">
    <a style="color: #ffffff;text-decoration: none; " href="/"><font face = "Gill" size =" 5">Digital Vehicle Management System</font><br /></a>  
      <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse justify-content-between" id="navbarCollapse">
        <div class="navbar-nav">
          <p style="
          padding-left: 15px;
      "  class="nav-item nav-link active"></p>

          <a href="/customer/customerclick" class="nav-item nav-link">Customer</a>
          
          <a href="/adminlogin" class="nav-item nav-link">Admin</a>


        </div>

        <div class="navbar-nav">
          <a href="/aboutus" class="nav-item nav-link">About Us</a>
          <a href="/contactus" class="nav-item nav-link">Contact Us</a>
          
        </div>




      </div>
    </nav>
  </div>


  homepage.jpg
        """

Django settings for insurancemanagement project.

Generated by 'django-admin startproject' using Django 3.0.5.

For more information on this file, see

https://docs.djangoproject.com/en/3.0/topics/settings/

For the full list of settings and their values, see

https://docs.djangoproject.com/en/3.0/ref/settings/

"""

import os

# Build paths inside the project like this: os.path.join(BASE_DIR, ...)

BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))

TEMPLATE_DIR = os.path.join(BASE_DIR,'templates')

STATIC_DIR=os.path.join(BASE_DIR,'static')

MEDIA_ROOT=os.path.join(BASE_DIR,'static')

# Quick-start development settings - unsuitable for production

# See https://docs.djangoproject.com/en/3.0/howto/deployment/checklist/

# SECURITY WARNING: keep the secret key used in production secret!

SECRET_KEY = 'ls@!_(edqp*xy76kvbsst$07at(v^li*2&ew!^$8o(@wa6@a+$'

# SECURITY WARNING: don't run with debug turned on in production!

DEBUG = True

ALLOWED_HOSTS = []

# Application definition

INSTALLED_APPS = [

    'django.contrib.admin',

    'django.contrib.auth',

    'django.contrib.contenttypes',

    'django.contrib.sessions',

    'django.contrib.messages',

    'django.contrib.staticfiles',

    'widget_tweaks',

    'insurance',

    'customer',

]

MIDDLEWARE = [

    'django.middleware.security.SecurityMiddleware',

    'django.contrib.sessions.middleware.SessionMiddleware',

    'django.middleware.common.CommonMiddleware',

    'django.middleware.csrf.CsrfViewMiddleware',

    'django.contrib.auth.middleware.AuthenticationMiddleware',

    'django.contrib.messages.middleware.MessageMiddleware',

    'django.middleware.clickjacking.XFrameOptionsMiddleware',

]

ROOT_URLCONF = 'insurancemanagement.urls'

TEMPLATES = [

    {

        'BACKEND': 'django.template.backends.django.DjangoTemplates',

        'DIRS': [TEMPLATE_DIR,],

        'APP_DIRS': True,

        'OPTIONS': {

            'context_processors': [

                'django.template.context_processors.debug',

                'django.template.context_processors.request',

                'django.contrib.auth.context_processors.auth',

                'django.contrib.messages.context_processors.messages',

            ],

        },

    },

]

WSGI_APPLICATION = 'insurancemanagement.wsgi.application'

# Database

# https://docs.djangoproject.com/en/3.0/ref/settings/#databases

DATABASES = {

    'default': {

        'ENGINE': 'django.db.backends.sqlite3',

        'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),

    }

}

# Password validation

# https://docs.djangoproject.com/en/3.0/ref/settings/#auth-password-validators

AUTH_PASSWORD_VALIDATORS = [

    {

        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',

    },

    {

        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',

    },

    {

        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',

    },

    {

        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',

    },

]

# Internationalization

# https://docs.djangoproject.com/en/3.0/topics/i18n/

LANGUAGE_CODE = 'en-us'

TIME_ZONE = 'UTC'

USE_I18N = True

USE_L10N = True

USE_TZ = True

# Static files (CSS, JavaScript, Images)

# https://docs.djangoproject.com/en/3.0/howto/static-files/

STATIC_URL = '/static/'

STATICFILES_DIRS=[

STATIC_DIR,

 ]

LOGIN_REDIRECT_URL='/afterlogin'

#for contact us give your gmail id and password

EMAIL_BACKEND ='django.core.mail.backends.smtp.EmailBackend'

EMAIL_HOST = 'smtp.gmail.com'

EMAIL_USE_TLS = True

EMAIL_PORT = 587

EMAIL_HOST_USER = 'from@gmail.com' # this email will be used to send emails

EMAIL_HOST_PASSWORD = 'xyz' # host email password required

# now sign in with your host gmail account in your browser

# open following link and turn it ON

# https://myaccount.google.com/lesssecureapps

# otherwise you will get SMTPAuthenticationError at /contactus

# this process is required because google blocks apps authentication by default

EMAIL_RECEIVING_USER = ['to@gmail.com'] # email on which you will receive messages sent from websit
        
        

from django.contrib import admin

from django.urls import path

from insurance import views

from django.contrib.auth.views import LogoutView,LoginView

from django.urls import path,include

urlpatterns = [

    path('admin/', admin.site.urls),

    path('customer/',include('customer.urls')),

    path('',views.home_view,name=''),

    path('logout', LogoutView.as_view(template_name='insurance/logout.html'),name='logout'),

    path('aboutus', views.aboutus_view),

    path('contactus', views.contactus_view),

    path('afterlogin', views.afterlogin_view,name='afterlogin'),

    

    path('adminlogin', LoginView.as_view(template_name='insurance/adminlogin.html'),name='adminlogin'),

    path('admin-dashboard', views.admin_dashboard_view,name='admin-dashboard'),

    path('admin-view-customer', views.admin_view_customer_view,name='admin-view-customer'),

    path('update-customer/<int:pk>', views.update_customer_view,name='update-customer'),

    path('delete-customer/<int:pk>', views.delete_customer_view,name='delete-customer'),

    path('admin-category', views.admin_category_view,name='admin-category'),

    path('admin-view-category', views.admin_view_category_view,name='admin-view-category'),

    path('admin-update-category', views.admin_update_category_view,name='admin-update-category'),

    path('update-category/<int:pk>', views.update_category_view,name='update-category'),

    path('admin-add-category', views.admin_add_category_view,name='admin-add-category'),

    path('admin-delete-category', views.admin_delete_category_view,name='admin-delete-category'),

    path('delete-category/<int:pk>', views.delete_category_view,name='delete-category'),

    path('admin-policy', views.admin_policy_view,name='admin-policy'),

    path('admin-add-policy', views.admin_add_policy_view,name='admin-add-policy'),

    path('admin-view-policy', views.admin_view_policy_view,name='admin-view-policy'),

    path('admin-update-policy', views.admin_update_policy_view,name='admin-update-policy'),

    path('update-policy/<int:pk>', views.update_policy_view,name='update-policy'),

    path('admin-delete-policy', views.admin_delete_policy_view,name='admin-delete-policy'),

    path('delete-policy/<int:pk>', views.delete_policy_view,name='delete-policy'),

    path('admin-view-policy-holder', views.admin_view_policy_holder_view,name='admin-view-policy-holder'),

    path('admin-view-approved-policy-holder', views.admin_view_approved_policy_holder_view,name='admin-view-approved-policy-holder'),

    path('admin-view-disapproved-policy-holder', views.admin_view_disapproved_policy_holder_view,name='admin-view-disapproved-policy-holder'),

    path('admin-view-waiting-policy-holder', views.admin_view_waiting_policy_holder_view,name='admin-view-waiting-policy-holder'),

    path('approve-request/<int:pk>', views.approve_request_view,name='approve-request'),

    path('reject-request/<int:pk>', views.disapprove_request_view,name='reject-request'),

    path('admin-question', views.admin_question_view,name='admin-question'),

    path('update-question/<int:pk>', views.update_question_view,name='update-question'),

]
        from django.shortcuts import render,redirect,reverse

from . import forms,models

from django.db.models import Sum

from django.contrib.auth.models import Group

from django.http import HttpResponseRedirect

from django.contrib.auth.decorators import login_required,user_passes_test

from django.conf import settings

from datetime import date, timedelta

from django.db.models import Q

from django.core.mail import send_mail

from insurance import models as CMODEL

from insurance import forms as CFORM

from django.contrib.auth.models import User

def customerclick_view(request):

    if request.user.is_authenticated:

        return HttpResponseRedirect('afterlogin')

    return render(request,'customer/customerclick.html')

def customer_signup_view(request):

    userForm=forms.CustomerUserForm()

    customerForm=forms.CustomerForm()

    mydict={'userForm':userForm,'customerForm':customerForm}

    if request.method=='POST':

        userForm=forms.CustomerUserForm(request.POST)

        customerForm=forms.CustomerForm(request.POST,request.FILES)

        if userForm.is_valid() and customerForm.is_valid():

            user=userForm.save()

            user.set_password(user.password)

            user.save()

            customer=customerForm.save(commit=False)

            customer.user=user

            customer.save()

            my_customer_group = Group.objects.get_or_create(name='CUSTOMER')

            my_customer_group[0].user_set.add(user)

        return HttpResponseRedirect('customerlogin')

    return render(request,'customer/customersignup.html',context=mydict)

def is_customer(user):

    return user.groups.filter(name='CUSTOMER').exists()

@login_required(login_url='customerlogin')

def customer_dashboard_view(request):

    dict={

        'customer':models.Customer.objects.get(user_id=request.user.id),

        'available_policy':CMODEL.Policy.objects.all().count(),

        'applied_policy':CMODEL.PolicyRecord.objects.all().filter(customer=models.Customer.objects.get(user_id=request.user.id)).count(),

        'total_category':CMODEL.Category.objects.all().count(),

        'total_question':CMODEL.Question.objects.all().filter(customer=models.Customer.objects.get(user_id=request.user.id)).count(),

    }

    return render(request,'customer/customer_dashboard.html',context=dict)

def apply_policy_view(request):

    customer = models.Customer.objects.get(user_id=request.user.id)

    policies = CMODEL.Policy.objects.all()

    return render(request,'customer/apply_policy.html',{'policies':policies,'customer':customer})

def apply_view(request,pk):

    customer = models.Customer.objects.get(user_id=request.user.id)

    policy = CMODEL.Policy.objects.get(id=pk)

    policyrecord = CMODEL.PolicyRecord()

    policyrecord.Policy = policy

    policyrecord.customer = customer

    policyrecord.save()

    return redirect('history')

def history_view(request):

    customer = models.Customer.objects.get(user_id=request.user.id)

    policies = CMODEL.PolicyRecord.objects.all().filter(customer=customer)

    return render(request,'customer/history.html',{'policies':policies,'customer':customer})

def ask_question_view(request):

    customer = models.Customer.objects.get(user_id=request.user.id)

    questionForm=CFORM.QuestionForm() 

    

    if request.method=='POST':

        questionForm=CFORM.QuestionForm(request.POST)

        if questionForm.is_valid():

            

            question = questionForm.save(commit=False)

            question.customer=customer

            question.save()

            return redirect('question-history')

    return render(request,'customer/ask_question.html',{'questionForm':questionForm,'customer':customer})

def question_history_view(request):

    customer = models.Customer.objects.get(user_id=request.user.id)

    questions = CMODEL.Question.objects.all().filter(customer=customer)

    return render(request,'customer/question_history.html',{'questions':questions,'customer':customer})
        from django.db import models

from django.contrib.auth.models import User

class Customer(models.Model):

    user=models.OneToOneField(User,on_delete=models.CASCADE)

    profile_pic= models.ImageField(upload_to='profile_pic/Customer/',null=True,blank=True)

    address = models.CharField(max_length=40)

    mobile = models.CharField(max_length=20,null=False)

   

    @property

    def get_name(self):

        return self.user.first_name+" "+self.user.last_name

    @property

    def get_instance(self):

        return self

    def __str__(self):

        return self.user.first_name
